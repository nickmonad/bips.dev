<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="description" content="Read BIPs like a pro." />
    <meta name="keywords" content="bitcoin, bitcoin improvement proposals, bip, bips, static, share" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:title" content="BIP 388: Wallet Policies for Descriptor Wallets" />
    <meta property="og:description" content="Read BIPs like a pro." />
    <meta property="og:image" content="https://bips.dev/og-bips-dev.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="BIP 388: Wallet Policies for Descriptor Wallets" />
    <meta name="twitter:description" content="Read BIPs like a pro." />
    <meta name="twitter:creator" content="@nickmonad" />
    <meta name="twitter:image" content="https://bips.dev/og-bips-dev.png" />

    <title>BIP 388: Wallet Policies for Descriptor Wallets</title>

    
        <link rel="stylesheet" href="/style.css" />
    

    <link rel="stylesheet" href="/pagefind/pagefind-ui.css" />
    <script src="/pagefind/pagefind-ui.js"></script>

    <script defer data-domain="bips.dev" src="/js/script.js"></script>
    <script>
        // setup plausible function for custom events
        window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }

        // setup and initialize dark mode
        // https://tailwindcss.com/docs/dark-mode
        window.setTheme = function() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark')
            } else {
                document.documentElement.classList.remove('dark')
            }
        }
        window.setTheme();

        // searching via
        // https://pagefind.app
        window.addEventListener('DOMContentLoaded', function(event) {
            new PagefindUI({
                element: "#search",
                hightlightParam: "highlight",
                showImages: false,
                showSubResults: true,
                translations: {
                    placeholder: "Search BIPs"
                },
                processTerm: function(term) {
                    plausible('Search');
                    return term;
                }
            });
        });
    </script>

    <style>
        /* variables to override on pagefind */
        /* https://pagefind.app/docs/ui-usage/#customising-the-styles */
        /* values are from tailwind: https://tailwindcss.com/docs/customizing-colors */
        :root {
            --pagefind-ui-primary: #334155;
            --pagefind-ui-text: #334155;
            --pagefind-ui-background: #ffffff;
            --pagefind-ui-border-width: 1px;
            --pagefind-ui-border-radius: 4px;
        }

        html.dark {
            --pagefind-ui-primary: #d1d5db;
            --pagefind-ui-text: #d1d5db;
            --pagefind-ui-background: #18181b;
            --pagefind-ui-border: #152028;
        }

        mark {
            background-color: #ff9900 !important;
            color: #6b7280 !important;
        }
    </style>
</head>

<body class="bg-white dark:bg-zinc-900">
    <div class="container mx-auto flex justify-center">
        <div data-pagefind-body class="min-w-full max-w-full lg:min-w-[1000px] lg:max-w-[1000px] px-6 py-10 space-y-10 text-slate-700 dark:text-gray-300">
            
    <div class="flex flex-col space-y-4 pt-4 md:pt-8">
        <div class="flex justify-between">
            <a href="/">Back to BIPs</a>
            <div class="flex">
                <svg id="toggleDark_light" class="hidden dark:flex w-6 h-6 hover:cursor-pointer" onclick="localStorage.theme = 'light'; window.setTheme()"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
                </svg>
                <svg id="toggleDark_dark" class="flex dark:hidden w-6 h-6 hover:cursor-pointer" onclick="localStorage.theme = 'dark'; window.setTheme()"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
                </svg>
            </div>
        </div>
        <div class="flex flex-col space-y-2">
            <div data-pagefind-weight="10" class="text-2xl font-extrabold">BIP 388: Wallet Policies for Descriptor Wallets</div>
            <div class="flex justify-between">
                <div class="text-xl font-semibold">2022-11-16</div>
                <a href="https:&#x2F;&#x2F;github.com&#x2F;bitcoin&#x2F;bips&#x2F;blob&#x2F;master&#x2F;bip-0388.mediawiki" target="_blank">View on GitHub</a>
            </div>
        </div>

        <article class="max-w-none prose prose-lg prose-zinc prose-p:leading-relaxed prose-a:font-bold prose-a:underline prose-a:decoration-2 prose-a:decoration-bitcoin prose-pre:bg-zinc-200 prose-pre:text-zinc-800 dark:prose-invert dark:prose-pre:bg-zinc-600 dark:prose-pre:text-white">
            <pre><code>  BIP: 388
  Layer: Applications
  Title: Wallet Policies for Descriptor Wallets
  Author: Salvatore Ingala &lt;salvatoshi@protonmail.com&gt;
  Comments-Summary: No comments yet.
  Comments-URI: https:&#x2F;&#x2F;github.com&#x2F;bitcoin&#x2F;bips&#x2F;wiki&#x2F;Comments:BIP-0388
  Status: Proposed
  Type: Standards Track
  Created: 2022-11-16
  License: BSD-2-Clause
  Post-History: 2022-05-10: https:&#x2F;&#x2F;lists.linuxfoundation.org&#x2F;pipermail&#x2F;bitcoin-dev&#x2F;2022-May&#x2F;020423.html
</code></pre>
<h2> Abstract </h2>
<p>Software wallets and hardware signing devices typically partition funds into separate &quot;accounts&quot;. When signing or visualizing a transaction, aggregate flows of funds of all accounts affected by the transaction may (and should) be displayed to the user.</p>
<p>Wallet policies build on top of output script descriptors to represent such accounts in a compact, reviewable way.
An account encompasses a logical group of receive and change addresses, and each wallet policy represents all descriptors necessary to describe an account in its entirety.</p>
<p>We simplify the language to suit devices with limited memory, where even keeping the entire descriptor in memory could be a major hurdle, by reducing the generality of descriptors to just the essential features and by separating the extended pubkeys and other key information from the descriptor.</p>
<p>This results in a more compact representation and simplifies the inspection of the policy by the user.</p>
<p>The compilation of wallet policies to the corresponding descriptor is trivial, and the reverse process is easy for supported descriptors, because the language is kept similar to that of output script descriptors.</p>
<h2> Copyright </h2>
<p>This BIP is licensed under the BSD 2-clause license.</p>
<h2> Motivation </h2>
<p><em><a href="/380" target="_blank">Output Script Descriptors</a></em> were introduced in Bitcoin Core as a way to represent collections of output scripts. It is a general and flexible language, designed to catch all the possible use-cases of bitcoin wallets (that is, if you know the script and you have the necessary keys, it will be possible to sign transactions with any descriptor-based software wallet).</p>
<p>Unfortunately, descriptors are not a perfect match for the typical usage of hardware signing devices (often also called <em>hardware wallets</em>). Most of them have some of the following limitations when compared to a general-purpose machine running Bitcoin Core:</p>
<ul>
<li>they are embedded devices with limited RAM and computational power;</li>
<li>they cannot import additional private keys (that is, they can only sign with keys derived from a single seed via <a href="/32" target="_blank">BIP-32</a>);</li>
<li>they have limited storage, or they might not have persistent storage at all (<em>stateless design</em>).</li>
</ul>
<p>Moreover, other limitations like the limited size of the screen might affect what design choices are available in practice. Therefore, minimizing the amount of information shown on-screen is important for a good user experience. The ability for the user to completely validate on-screen the kind of script used (and each of the involved keys) is crucial for secure usage, as the machine that is interacting with the hardware signer (and running the software wallet) is considered untrusted.</p>
<p>A more native, compact representation of the wallet receive and change addresses might also benefit the UX of software wallets when they use descriptors (possibly with miniscript) for representing complex locking conditions.</p>
<p>We remark that wallet policies are not related to the <em>policy</em> language, a higher level language that can be compiled to <a href="bip-0379.md" target="_blank">miniscript</a>.</p>
<h3> Security, privacy and UX concerns for hardware signing devices </h3>
<p>The usage of complex scripts presents challenges in terms of both security and user experience for a hardware signing device.</p>
<h4> Security issues </h4>
<p>Hardware signing devices strive to guarantee that no action can be performed without the userâ€™s consent as long as the user correctly verifies the information that is shown on the deviceâ€™s screen before approving.</p>
<p>This must hold even in scenarios where the attacker has full control of the machine that is connected to the signing device, and can execute arbitrary requests, or tamper with the legitimate user's requests.</p>
<p>Therefore, it is not at all trivial to allow complex scripts, especially if they contain keys that belong to third parties.
The hardware signing device must guarantee that the user knows precisely what &quot;policy&quot; is being used to spend the funds, and that any &quot;unspent&quot; funds (if any) that is sent to a change address will be protected by the same policy.</p>
<p>This makes it impossible for an attacker to surreptitiously modify the policy, therefore stealing or burning the user's funds.</p>
<h4> Avoiding key reuse </h4>
<p>Reusing public keys within a script is a source of malleability when using miniscript policies, which has potential security implications.</p>
<p>Reusing keys across different UTXOs harms user privacy by allowing external parties to link these UTXOs to the same entity once they are spent.</p>
<p>By constraining the derivation path patterns to have a uniform structure, wallet policies prevent key reuse among the same or different UTXOs of the same account.</p>
<p>It is strongly recommended to avoid key reuse across accounts. Distinct public keys per account can be guaranteed by using distinct hardened derivation paths. This specification does not mandate hardened derivation in order to maintain compatibility with existing deployments that do not adhere to this recommendation.</p>
<p>It is out of scope for this document to guarantee that users do not reuse extended public keys among different wallet accounts. This is still very important, but the responsibility is left to the users and their software wallet.</p>
<h4> UX issues </h4>
<p>Miniscript (and taproot trees) allow substantially more complex spending policies. It is a challenge to ensure that the user can practically verify such spending policies on the screen.</p>
<p>We set two fundamental design goals:</p>
<ul>
<li>Minimize the amount of information that is shown on screen - so that the user can actually validate it.</li>
<li>Minimize the number of times the user has to validate such information.</li>
</ul>
<p>Designing a secure protocol for the coordination of a descriptor wallet among distant parties is also a challenging problem that is out of the scope of this document. See <a href="/129" target="_blank">BIP-129 (Bitcoin Secure Multisig Setup)</a> for an approach designed for multisig wallets. Regardless of the approach, the ability for the user to carefully verify all the details of the spending policies using the hardware signer's screen is a prerequisite for security in adversarial environments.</p>
<h3> Policy registration as a solution </h3>
<p>A solution to address the security concerns, and part of the UX concerns, is to have a registration flow for the wallet policy in the hardware signing device. The <em>wallet policy</em> must contain enough information to generate all the relevant addresses/scripts, and for the hardware signing device to identify the keys that it controls and that are needed to spend the funds sent to those addresses.</p>
<p>Before a new policy is used for the first time, the user will register a wallet policy into the hardware device. While the details of the process are out of scope in this document, the flow should be something similar to the following:</p>
<ol>
<li>The software wallet initiates a <em>wallet policy registration</em> on the hardware signing device; the information should include the wallet policy, but also a unique <em>name</em> that identifies the policy.</li>
<li>The device shows the wallet policy to the user using the secure screen.</li>
<li>After inspecting the policy and comparing it with a trusted source (for example a printed backup), the user approves the policy.</li>
<li>If stateful, the hardware signing device persists the policy in its permanent memory; if stateless, it returns a &quot;proof of registration&quot;.</li>
</ol>
<p>The <strong>proof of registration</strong> will allow the hardware signer to verify that a certain policy was indeed previously approved by the user, and is therefore safe to use without repeating the expensive user verification procedure. The details of how to create a proof of registration are out of scope for this document; using a Message Authentication Code on a hash committing to the wallet policy, its name and any additional metadata is an effective solution if correctly executed.</p>
<p>Once a policy is registered, the hardware signing device can perform the typical operations securely:</p>
<ul>
<li>generating receive and change addresses;</li>
<li>showing addresses on the secure screen;</li>
<li>sign transactions spending from a wallet, while correctly identifying change addresses and computing the transaction fees.</li>
</ul>
<p>Before any of the actions mentioned above, the hardware signing device will retrieve the policy from its permanent storage if stateful; if stateless it will validate the proof of registration before using the wallet policy provided by the client.</p>
<p>Once the previously registered policy is correctly identified and approved by the user (for example by showing its name), and as long as the policy registration was executed securely, hardware signing devices can provide a user experience similar to the usual one for single-signature transactions.</p>
<h3> Avoiding blowup in descriptor size </h3>
<p>While reusing a pubkey in different branches of a miniscript is explicitly forbidden by miniscript (as it has certain negative security implications), it is still reasonable to reuse the same xpub in multiple places, albeit with different final steps of derivation (so that the actual pubkeys that are used in the script are indeed different).</p>
<p>In fact, there are many reasonable spending policies with a quadratic size in the number of participants. For example, using Taproot, a 3-of-5 threshold wallet could use:</p>
<ul>
<li>a key path with a 5-of-5 <a href="/327" target="_blank">MuSig2</a> aggregated key</li>
<li>a script tree with 11 leaves:
<ul>
<li>10 different scripts using a 3-of-3 MuSig2 aggregated key, plus</li>
<li>a final leaf with a fallback 3-of-5 multisig using <tt>multi_a</tt> (in case interactive signing is not available).</li>
</ul>
</li>
</ul>
<p>With each xpub being 118 bytes long, the repetition of xpubs makes the descriptor become extremely large.</p>
<p>Replacing the common part of the key with a short key placeholder and organizing all the key expressions in a separate list helps to keep the size of the wallet policy small, which is crucial to allow human inspection during the registration flow.</p>
<h2> Specification </h2>
<p>This section formally defines wallet policies, and how they relate to output script descriptors.</p>
<h3> Formal definition </h3>
<p>A <em>wallet policy</em> is composed of a <em>wallet descriptor template</em>, together with a vector of <em>key information items</em>.</p>
<h4> Wallet descriptor template </h4>
<p>A <em>wallet descriptor template</em> is a <tt>SCRIPT</tt> expression.</p>
<p><tt>SCRIPT</tt> expressions:</p>
<ul>
<li><tt>sh(SCRIPT)</tt> (top level only): P2SH embed the argument.</li>
<li><tt>wsh(SCRIPT)</tt> (top level or inside <tt>sh</tt> only): P2WSH embed the argument.</li>
<li><tt>pkh(KEY)</tt> (not inside <tt>tr</tt>): P2PKH output for the given public key.</li>
<li><tt>wpkh(KEY)</tt> (top level or inside <tt>sh</tt> only): P2WPKH output for the given compressed pubkey.</li>
<li><tt>multi(k,KEY_1,KEY_2,...,KEY_n)</tt> (inside <tt>sh</tt> or <tt>wsh</tt> only): <em>k</em>-of-<em>n</em> multisig script.</li>
<li><tt>sortedmulti(k,KEY_1,KEY_2,...,KEY_n)</tt> (inside <tt>sh</tt> or <tt>wsh</tt> only): <em>k</em>-of-<em>n</em> multisig script with keys sorted lexicographically in the resulting script.</li>
<li><tt>tr(KEY)</tt> or <tt>tr(KEY,TREE)</tt> (top level only): P2TR output with the specified key as internal key, and optionally a tree of script paths.</li>
<li>any valid miniscript template (inside <tt>wsh</tt> or <tt>tr</tt> only).</li>
</ul>
<p>See <a href="bip-0379.md" target="_blank">BIP-379</a> for a precise specification of all the valid miniscript <tt>SCRIPT</tt> expressions.</p>
<p><tt>TREE</tt> expressions:</p>
<ul>
<li>any <tt>SCRIPT</tt> expression</li>
<li>An open brace <tt>{</tt>, a <tt>TREE</tt> expression, a comma <tt>,</tt>, a <tt>TREE</tt> expression, and a closing brace <tt>}</tt></li>
</ul>
<p><tt>KEY</tt> expressions consist of</p>
<ul>
<li>a <tt>KP</tt> expression</li>
<li><em>always</em> followed by either:
<ul>
<li>the string  <tt>/**</tt>, or</li>
<li>a string of the form <tt>/&lt;NUM;NUM&gt;/*</tt>, for two distinct decimal numbers <tt>NUM</tt> representing unhardened derivations, or</li>
<li>any of the additional, implementation-specific valid derivation path patterns (see <a href=" optional-derivation-paths" target="_blank">Optional derivation paths</a> below).</li>
</ul>
</li>
</ul>
<p><tt>KP</tt> expressions (key placeholders) consist of either:</p>
<ul>
<li>a <tt>KI</tt> (key index) expression, or</li>
<li>(only inside <tt>tr</tt>): <tt>musig(KI_1,KI_2,...,KI_n)</tt></li>
</ul>
<p>A <tt>KI</tt> (key index) expression consists of:</p>
<ul>
<li>a single character <tt>@</tt></li>
<li>followed by a non-negative decimal number, with no leading zeros (except for <tt>@0</tt>)</li>
</ul>
<p>The <tt>/**</tt> in the placeholder template represents commonly used paths for receive/change addresses, and is equivalent to <tt>/&lt;0;1&gt;/*</tt>.</p>
<p>Note that while <a href="/389" target="_blank">BIP-389</a> allows multipath <tt>/&lt;NUM;NUM;...;NUM&gt;</tt> expressions with an arbitrary number of options, this specification restricts it to exactly 2 choices (with the typical meaning of receive/change addresses).</p>
<p><tt>SCRIPT</tt>, <tt>TREE</tt> and <tt>KEY</tt> expressions map directly to the corresponding concepts defined in <a href="/380" target="_blank">BIP-380</a> for output script descriptors.</p>
<p>Each <tt>KEY</tt> expression always corresponds to a precise public key in the final bitcoin Script. Therefore, all the derivation steps in the BIP-32 hierarchy are included in a <tt>KEY</tt> expression.</p>
<p>Each <tt>KP</tt> (key placeholder) expression, on the other hand, maps to the root of all the corresponding public keys for all the possible UTXOs that belong to the account represented in the wallet policy. Therefore, no derivation steps are allowed in a <tt>KP</tt> expression.</p>
<p>A <tt>KI</tt> (key index) <tt>@i</tt> for some number <em>i</em> represents the <em>i</em>-th key in the vector of key information items (which must be of size at least <em>i + 1</em>, or the wallet policy is invalid).</p>
<p>Note: while descriptor templates for miniscript are not formally defined in this version of the document (pending standardization), it is straightforward to adapt this approach by adding additional <tt>SCRIPT</tt> expressions.</p>
<h4> Key information vector </h4>
<p>Each element of the key origin information vector is a <tt>KEY_INFO</tt> expression, containing an extended public key, and (optionally) its key origin.</p>
<ul>
<li>Optionally, key origin information, consisting of:
<ul>
<li>An open bracket <tt>[</tt></li>
<li>Exactly 8 hex characters for the fingerprint of the master key from which this key is derived from (see <a href="/32" target="_blank">BIP-32</a> for details)</li>
<li>Followed by zero or more <tt>/NUM'</tt> or <tt>/NUM</tt> path elements to indicate hardened or unhardened derivation steps between the fingerprint and the xpub that follows</li>
<li>A closing bracket <tt>]</tt></li>
</ul>
</li>
<li>Followed by the actual key, which is a serialized extended public key (as defined in <a href="/32" target="_blank">BIP-32</a>).</li>
</ul>
<h4> Additional rules </h4>
<p>A wallet policy must have at least one key placeholder and the corresponding key.</p>
<p>The public keys obtained by deserializing elements of the key information vector must be pairwise distinct<sup id="cite_ref_1"><a href="#cite_ref_1">1</a></sup>.</p>
<p>If two <tt>KEY</tt> are <tt>KP/&lt;M;N&gt;/<em></tt> and <tt>KP/&lt;P;Q&gt;/</em></tt> for the same key placeholder <tt>KP</tt>, then the sets <tt>{M, N}</tt> and <tt>{P, Q}</tt> must be disjoint. Two <tt>musig</tt> key placeholders are the same if they have exactly the same set of key indexes (regardless of the order).</p>
<p>Repeated <tt>KI</tt> expressions are not allowed inside a <tt>musig</tt> placeholder.</p>
<p>The key information vector should be ordered so that placeholder <tt>@i</tt> never appears for the first time before an occurrence of <tt>@j</tt>  for some <tt>j &lt; i</tt>; for example, the first placeholder is always <tt>@0</tt>, the next one is <tt>@1</tt>, etc.</p>
<h3> Descriptor derivation </h3>
<p>From a wallet descriptor template (and the associated vector of key information items), one can therefore obtain the corresponding multipath descriptor by:</p>
<ul>
<li>replacing each key placeholder with the corresponding key origin information;</li>
<li>replacing every <tt>/**</tt> with <tt>/&lt;0;1&gt;/*</tt>.</li>
</ul>
<p>For example, the wallet descriptor <tt>pkh(@0/**)</tt> with key information
<tt>[&quot;[d34db33f/44'/0'/0']xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL&quot;]</tt>
produces the following multipath descriptor:</p>
<p><tt>pkh([d34db33f/44'/0'/0']xpub6ERApfZwUNrhLCkDtcHTcxd75RbzS1ed54G1LkBUHQVHQKqhMkhgbmJbZRkrgZw4koxb5JaHWkY4ALHY2grBGRjaDMzQLcgJvLJuZZvRcEL/&lt;0;1&gt;/*)</tt></p>
<h3> Implementation guidelines </h3>
<p>It is acceptable to implement only a subset of the possible wallet policies defined by this standard. It is recommended that any limitations are clearly documented.</p>
<p>Implementations can add additional metadata that is stored together with the wallet policy for the purpose of wallet policy registration and later usage. Metadata can be vendor-specific and is out of the scope of this document.</p>
<p>Any implementation in a software wallet that allows wallet policies not matching any of the specifications in <a href="/44" target="_blank">BIP-44</a>, <a href="/49" target="_blank">BIP-49</a>, <a href="/84" target="_blank">BIP-84</a>, <a href="/86" target="_blank">BIP-86</a> (especially if involving external cosigners) should put great care into a process for backing up the wallet policy that represents the account. In fact, unlike standard single-signature scenarios, the seed alone is no longer enough to discover wallet policies with existing funds, and the loss of the backup is likely to lead to permanent loss of funds. Unlike the seed, leaking such backups only affects the privacy of the user, but it does not allow the attacker to steal funds.</p>
<h3> Optional derivation paths </h3>
<p>In order to allow supporting legacy derivation schemes (for example, using simply <tt>/<em></tt> instead of the more common <tt>/&lt;M;N&gt;/</em></tt> scheme most software wallets use today), or other schemes that are not covered in this document, implementations might choose to permit additional derivation patterns for the key placeholder (<tt>KP</tt>) expressions.</p>
<p>However, care needs to be taken in view of the following considerations:</p>
<ul>
<li>Allowing derivation schemes with a different length or cardinality in the same wallet policy would make it difficult to guarantee that there are no repeated pubkeys for every possible address generated by the policy. For example, <tt>@0/&lt;0;1&gt;/<em></tt> and <tt>@1/</em></tt> would generate the same pubkeys if the second public key in the key information vector is one of the first two unhardened children of the first public key. This could cause malleability with potential security implications (for example, in policies containing miniscript).</li>
<li>Allowing naked pubkeys with no <tt>/<em></tt> suffix (for example a descriptor template like <tt>wsh(multi(2,@0,@1/&lt;0;1&gt;/</em>))</tt>) would cause a pubkey to be repeated in every output generated from the policy, which would result in a total loss of privacy.</li>
</ul>
<h2> Examples </h2>
<p>In the examples in this section, the vector of key information items is omitted. See the test vectors below for complete examples.</p>
<p>Common single-signature account patterns:</p>
<ul>
<li><tt>pkh(@0/**)</tt> (legacy).</li>
<li><tt>wpkh(@0/**)</tt> (native segwit).</li>
<li><tt>sh(wpkh(@0/**))</tt> (nested segwit).</li>
<li><tt>tr(@0/**)</tt> (taproot single-signature account).</li>
</ul>
<p>Common multisig schemes:</p>
<ul>
<li><tt>wsh(multi(2,@0/<strong>,@1/</strong>))</tt> - SegWit 2-of-2 multisig, keys in order.</li>
<li><tt>sh(sortedmulti(2,@0/<strong>,@1/</strong>,@2/**))</tt> - Legacy 2-of-3 multisig, sorted keys.</li>
<li><tt>tr(musig(@0,@1)/**)</tt> - MuSig2 2-of-2 in the taproot keypath</li>
</ul>
<p>Some miniscript policies in <tt>wsh</tt>:</p>
<ul>
<li><tt>wsh(and_v(v:pk(@0/<strong>),or_d(pk(@1/</strong>),older(12960))))</tt> - Trust-minimized second factor, degrading to a single signature after about 90 days.</li>
<li><tt>wsh(thresh(3,pk(@0/<strong>),s:pk(@1/</strong>),s:pk(@2/**),sln:older(12960)))</tt> - A 3-of-3 wallet that becomes a 2-of-3 if coins are not spent for about 90 days.</li>
<li><tt>wsh(or_d(pk(@0/<strong>),and_v(v:multi(2,@1/</strong>,@2/<strong>,@3/</strong>),older(65535))))</tt> - A singlesig wallet with automatic inheritance to a timelocked 2-of-3 multisig of family members.</li>
</ul>
<h2> Test Vectors </h2>
<h3> Valid policies </h3>
<p><a href="/44" target="_blank">BIP-44</a>, first account</p>
<pre><code> Descriptor template: pkh(@0&#x2F;**)
 Keys info: [&quot;[6738736c&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;]xpub6Br37sWxruYfT8ASpCjVHKGwgdnYFEn98DwiN76i2oyY6fgH1LAPmmDcF46xjxJr22gw4jmVjTE2E3URMnRPEPYyo1zoPSUba563ESMXCeb&quot;]
 Descriptor: pkh([6738736c&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;]xpub6Br37sWxruYfT8ASpCjVHKGwgdnYFEn98DwiN76i2oyY6fgH1LAPmmDcF46xjxJr22gw4jmVjTE2E3URMnRPEPYyo1zoPSUba563ESMXCeb&#x2F;&lt;0;1&gt;&#x2F;*)
&lt;br&gt;
[[bip-0049.mediawiki|BIP-49]], second account
 Descriptor template: sh(wpkh(@0&#x2F;**))
 Keys info: [&quot;[6738736c&#x2F;49&#x27;&#x2F;0&#x27;&#x2F;1&#x27;]xpub6Bex1CHWGXNNwGVKHLqNC7kcV348FxkCxpZXyCWp1k27kin8sRPayjZUKDjyQeZzGUdyeAj2emoW5zStFFUAHRgd5w8iVVbLgZ7PmjAKAm9&quot;]
 Descriptor: sh(wpkh([6738736c&#x2F;49&#x27;&#x2F;0&#x27;&#x2F;1&#x27;]xpub6Bex1CHWGXNNwGVKHLqNC7kcV348FxkCxpZXyCWp1k27kin8sRPayjZUKDjyQeZzGUdyeAj2emoW5zStFFUAHRgd5w8iVVbLgZ7PmjAKAm9&#x2F;&lt;0;1&gt;&#x2F;*))
&lt;br&gt;
[[bip-0084.mediawiki|BIP-84]], third account
 Descriptor template: wpkh(@0&#x2F;**)
 Keys info: [&quot;[6738736c&#x2F;84&#x27;&#x2F;0&#x27;&#x2F;2&#x27;]xpub6CRQzb8u9dmMcq5XAwwRn9gcoYCjndJkhKgD11WKzbVGd932UmrExWFxCAvRnDN3ez6ZujLmMvmLBaSWdfWVn75L83Qxu1qSX4fJNrJg2Gt&quot;]
 Descriptor: wpkh([6738736c&#x2F;84&#x27;&#x2F;0&#x27;&#x2F;2&#x27;]xpub6CRQzb8u9dmMcq5XAwwRn9gcoYCjndJkhKgD11WKzbVGd932UmrExWFxCAvRnDN3ez6ZujLmMvmLBaSWdfWVn75L83Qxu1qSX4fJNrJg2Gt&#x2F;&lt;0;1&gt;&#x2F;*)
&lt;br&gt;
[[bip-0086.mediawiki|BIP-86]], first account
 Descriptor template: tr(@0&#x2F;**)
 Keys info: [&quot;[6738736c&#x2F;86&#x27;&#x2F;0&#x27;&#x2F;0&#x27;]xpub6CryUDWPS28eR2cDyojB8G354izmx294BdjeSvH469Ty3o2E6Tq5VjBJCn8rWBgesvTJnyXNAJ3QpLFGuNwqFXNt3gn612raffLWfdHNkYL&quot;]
 Descriptor: tr([6738736c&#x2F;86&#x27;&#x2F;0&#x27;&#x2F;0&#x27;]xpub6CryUDWPS28eR2cDyojB8G354izmx294BdjeSvH469Ty3o2E6Tq5VjBJCn8rWBgesvTJnyXNAJ3QpLFGuNwqFXNt3gn612raffLWfdHNkYL&#x2F;&lt;0;1&gt;&#x2F;*)
&lt;br&gt;
[[bip-0048.mediawiki|BIP-48]] P2WSH multisig
 Descriptor template: wsh(sortedmulti(2,@0&#x2F;**,@1&#x2F;**))
 Keys info: [&quot;[6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;2&#x27;]xpub6FC1fXFP1GXLX5TKtcjHGT4q89SDRehkQLtbKJ2PzWcvbBHtyDsJPLtpLtkGqYNYZdVVAjRQ5kug9CsapegmmeRutpP7PW4u4wVF9JfkDhw&quot;, &quot;[b2b1f0cf&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;2&#x27;]xpub6EWhjpPa6FqrcaPBuGBZRJVjzGJ1ZsMygRF26RwN932Vfkn1gyCiTbECVitBjRCkexEvetLdiqzTcYimmzYxyR1BZ79KNevgt61PDcukmC7&quot;]
 Descriptor: wsh(sortedmulti(2,[6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;2&#x27;]xpub6FC1fXFP1GXLX5TKtcjHGT4q89SDRehkQLtbKJ2PzWcvbBHtyDsJPLtpLtkGqYNYZdVVAjRQ5kug9CsapegmmeRutpP7PW4u4wVF9JfkDhw&#x2F;&lt;0;1&gt;&#x2F;*,[b2b1f0cf&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;2&#x27;]xpub6EWhjpPa6FqrcaPBuGBZRJVjzGJ1ZsMygRF26RwN932Vfkn1gyCiTbECVitBjRCkexEvetLdiqzTcYimmzYxyR1BZ79KNevgt61PDcukmC7&#x2F;&lt;0;1&gt;&#x2F;*))
&lt;br&gt;
</code></pre>
<p>Miniscript: A 3-of-3 that becomes a 2-of-3 after 90 days</p>
<pre><code> Descriptor template: wsh(thresh(3,pk(@0&#x2F;**),s:pk(@1&#x2F;**),s:pk(@2&#x2F;**),sln:older(12960)))
 Keys info: [&quot;[6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa&quot;, &quot;[b2b1f0cf&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6EYajCJHe2CK53RLVXrN14uWoEttZgrRSaRztujsXg7yRhGtHmLBt9ot9Pd5ugfwWEu6eWyJYKSshyvZFKDXiNbBcoK42KRZbxwjRQpm5Js&quot;, &quot;[a666a867&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dgsze3ujLi1EiHoCtHFMS9VLS1UheVqxrHGfP7sBJ2DBfChEUHV4MDwmxAXR2ayeytpwm3zJEU3H3pjCR6q6U5sP2p2qzAD71x9z5QShK2&quot;]
 Descriptor: wsh(thresh(3,pk([6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa&#x2F;&lt;0;1&gt;&#x2F;*),s:pk([b2b1f0cf&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6EYajCJHe2CK53RLVXrN14uWoEttZgrRSaRztujsXg7yRhGtHmLBt9ot9Pd5ugfwWEu6eWyJYKSshyvZFKDXiNbBcoK42KRZbxwjRQpm5Js&#x2F;&lt;0;1&gt;&#x2F;*),s:pk([a666a867&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dgsze3ujLi1EiHoCtHFMS9VLS1UheVqxrHGfP7sBJ2DBfChEUHV4MDwmxAXR2ayeytpwm3zJEU3H3pjCR6q6U5sP2p2qzAD71x9z5QShK2&#x2F;&lt;0;1&gt;&#x2F;*),sln:older(12960)))
&lt;br&gt;
</code></pre>
<p>Miniscript: A singlesig wallet with automatic inheritance to a timelocked 2-of-3 multisig</p>
<pre><code> Descriptor template: wsh(or_d(pk(@0&#x2F;**),and_v(v:multi(2,@1&#x2F;**,@2&#x2F;**,@3&#x2F;**),older(65535))))
 Keys info: [&quot;[6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa&quot;, &quot;[b2b1f0cf&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6EYajCJHe2CK53RLVXrN14uWoEttZgrRSaRztujsXg7yRhGtHmLBt9ot9Pd5ugfwWEu6eWyJYKSshyvZFKDXiNbBcoK42KRZbxwjRQpm5Js&quot;, &quot;[a666a867&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dgsze3ujLi1EiHoCtHFMS9VLS1UheVqxrHGfP7sBJ2DBfChEUHV4MDwmxAXR2ayeytpwm3zJEU3H3pjCR6q6U5sP2p2qzAD71x9z5QShK2&quot;, &quot;[bb641298&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dz8PHFmXkYkykQ83ySkruky567XtJb9N69uXScJZqweYiQn6FyieajdiyjCvWzRZ2GoLHMRE1cwDfuJZ6461YvNRGVBJNnLA35cZrQKSRJ&quot;]
 Descriptor: wsh(or_d(pk([6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa&#x2F;&lt;0;1&gt;&#x2F;*),and_v(v:multi(2,[b2b1f0cf&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6EYajCJHe2CK53RLVXrN14uWoEttZgrRSaRztujsXg7yRhGtHmLBt9ot9Pd5ugfwWEu6eWyJYKSshyvZFKDXiNbBcoK42KRZbxwjRQpm5Js&#x2F;&lt;0;1&gt;&#x2F;*,[a666a867&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dgsze3ujLi1EiHoCtHFMS9VLS1UheVqxrHGfP7sBJ2DBfChEUHV4MDwmxAXR2ayeytpwm3zJEU3H3pjCR6q6U5sP2p2qzAD71x9z5QShK2&#x2F;&lt;0;1&gt;&#x2F;*,[bb641298&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dz8PHFmXkYkykQ83ySkruky567XtJb9N69uXScJZqweYiQn6FyieajdiyjCvWzRZ2GoLHMRE1cwDfuJZ6461YvNRGVBJNnLA35cZrQKSRJ&#x2F;&lt;0;1&gt;&#x2F;*),older(65535))))
&lt;br&gt;
</code></pre>
<p>Taproot wallet policy with sortedmulti_a and a miniscript leaf</p>
<pre><code> Descriptor template: tr(@0&#x2F;**,{sortedmulti_a(1,@0&#x2F;&lt;2;3&gt;&#x2F;*,@1&#x2F;**),or_b(pk(@2&#x2F;**),s:pk(@3&#x2F;**))})
 Keys info: [&quot;[6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa&quot;, &quot;xpub6Fc2TRaCWNgfT49nRGG2G78d1dPnjhW66gEXi7oYZML7qEFN8e21b2DLDipTZZnfV6V7ivrMkvh4VbnHY2ChHTS9qM3XVLJiAgcfagYQk6K&quot;, &quot;xpub6GxHB9kRdFfTqYka8tgtX9Gh3Td3A9XS8uakUGVcJ9NGZ1uLrGZrRVr67DjpMNCHprZmVmceFTY4X4wWfksy8nVwPiNvzJ5pjLxzPtpnfEM&quot;, &quot;xpub6GjFUVVYewLj5no5uoNKCWuyWhQ1rKGvV8DgXBG9Uc6DvAKxt2dhrj1EZFrTNB5qxAoBkVW3wF8uCS3q1ri9fueAa6y7heFTcf27Q4gyeh6&quot;]
 Descriptor: tr([6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa&#x2F;&lt;0;1&gt;&#x2F;*,{sortedmulti_a(1,[6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa&#x2F;&lt;2;3&gt;&#x2F;*,xpub6Fc2TRaCWNgfT49nRGG2G78d1dPnjhW66gEXi7oYZML7qEFN8e21b2DLDipTZZnfV6V7ivrMkvh4VbnHY2ChHTS9qM3XVLJiAgcfagYQk6K&#x2F;&lt;0;1&gt;&#x2F;*),or_b(pk(xpub6GxHB9kRdFfTqYka8tgtX9Gh3Td3A9XS8uakUGVcJ9NGZ1uLrGZrRVr67DjpMNCHprZmVmceFTY4X4wWfksy8nVwPiNvzJ5pjLxzPtpnfEM&#x2F;&lt;0;1&gt;&#x2F;*),s:pk(xpub6GjFUVVYewLj5no5uoNKCWuyWhQ1rKGvV8DgXBG9Uc6DvAKxt2dhrj1EZFrTNB5qxAoBkVW3wF8uCS3q1ri9fueAa6y7heFTcf27Q4gyeh6&#x2F;&lt;0;1&gt;&#x2F;*))})
&lt;br&gt;
</code></pre>
<p>Taproot MuSig2 3-of-3 in the key path, with three 2-of-2 MuSig2 recovery paths after 90 days in the script paths</p>
<pre><code> Descriptor template: tr(musig(@0,@1,@2)&#x2F;**,{and_v(v:pk(musig(@0,@1)&#x2F;**),older(12960)),{and_v(v:pk(musig(@0,@2)&#x2F;**),older(12960)),and_v(v:pk(musig(@1,@2)&#x2F;**),older(12960))}})
 Keys info: [&quot;[6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa&quot;, &quot;[b2b1f0cf&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6EYajCJHe2CK53RLVXrN14uWoEttZgrRSaRztujsXg7yRhGtHmLBt9ot9Pd5ugfwWEu6eWyJYKSshyvZFKDXiNbBcoK42KRZbxwjRQpm5Js&quot;, &quot;[a666a867&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dgsze3ujLi1EiHoCtHFMS9VLS1UheVqxrHGfP7sBJ2DBfChEUHV4MDwmxAXR2ayeytpwm3zJEU3H3pjCR6q6U5sP2p2qzAD71x9z5QShK2&quot;]
 Descriptor: tr(musig([6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa,[b2b1f0cf&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6EYajCJHe2CK53RLVXrN14uWoEttZgrRSaRztujsXg7yRhGtHmLBt9ot9Pd5ugfwWEu6eWyJYKSshyvZFKDXiNbBcoK42KRZbxwjRQpm5Js,[a666a867&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dgsze3ujLi1EiHoCtHFMS9VLS1UheVqxrHGfP7sBJ2DBfChEUHV4MDwmxAXR2ayeytpwm3zJEU3H3pjCR6q6U5sP2p2qzAD71x9z5QShK2)&#x2F;&lt;0;1&gt;&#x2F;*,{and_v(v:pk(musig([6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa,[b2b1f0cf&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6EYajCJHe2CK53RLVXrN14uWoEttZgrRSaRztujsXg7yRhGtHmLBt9ot9Pd5ugfwWEu6eWyJYKSshyvZFKDXiNbBcoK42KRZbxwjRQpm5Js)&#x2F;&lt;0;1&gt;&#x2F;*),older(12960)),{and_v(v:pk(musig([6738736c&#x2F;48&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6FC1fXFP1GXQpyRFfSE1vzzySqs3Vg63bzimYLeqtNUYbzA87kMNTcuy9ubr7MmavGRjW2FRYHP4WGKjwutbf1ghgkUW9H7e3ceaPLRcVwa,[a666a867&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dgsze3ujLi1EiHoCtHFMS9VLS1UheVqxrHGfP7sBJ2DBfChEUHV4MDwmxAXR2ayeytpwm3zJEU3H3pjCR6q6U5sP2p2qzAD71x9z5QShK2)&#x2F;&lt;0;1&gt;&#x2F;*),older(12960)),and_v(v:pk(musig([b2b1f0cf&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6EYajCJHe2CK53RLVXrN14uWoEttZgrRSaRztujsXg7yRhGtHmLBt9ot9Pd5ugfwWEu6eWyJYKSshyvZFKDXiNbBcoK42KRZbxwjRQpm5Js,[a666a867&#x2F;44&#x27;&#x2F;0&#x27;&#x2F;0&#x27;&#x2F;100&#x27;]xpub6Dgsze3ujLi1EiHoCtHFMS9VLS1UheVqxrHGfP7sBJ2DBfChEUHV4MDwmxAXR2ayeytpwm3zJEU3H3pjCR6q6U5sP2p2qzAD71x9z5QShK2)&#x2F;&lt;0;1&gt;&#x2F;*),older(12960))}})
</code></pre>
<h3> Invalid policies </h3>
<p>The following descriptor templates are invalid:</p>
<ul>
<li><tt>pkh(@0)</tt>: Key placeholder with no path following it</li>
<li><tt>pkh(@0/0/**)</tt>: Key placeholder with an explicit path present</li>
<li><tt>sh(multi(1,@1/<strong>,@0/</strong>))</tt>: Key placeholders out of order</li>
<li><tt>sh(multi(1,@0/<strong>,@2/</strong>))</tt>: Skipped key placeholder <tt>@1</tt></li>
<li><tt>sh(multi(1,@0/<strong>,@0/</strong>))</tt>: Repeated keys with the same path expression</li>
<li><tt>sh(multi(1,@0/&lt;0;1&gt;/<em>,@0/&lt;1;2&gt;/</em>))</tt>: Non-disjoint multipath expressions (<tt>@0/1/*</tt> appears twice)</li>
<li><tt>sh(multi(1,@0/**,xpub6AHA9hZDN11k2ijHMeS5QqHx2KP9aMBRhTDqANMnwVtdyw2TDYRmF8PjpvwUFcL1Et8Hj59S3gTSMcUQ5gAqTz3Wd8EsMTmF3DChhqPQBnU/&lt;0;1&gt;/*))</tt>: Expression with a non-KP key present</li>
<li><tt>pkh(@0/&lt;0;1;2&gt;/*)</tt>: Allowed cardinality &gt; 2</li>
<li><tt>tr(musig(@0/<strong>,@1/</strong>))</tt>: Derivation before aggregation is not allowed in wallet policies (despite being allowed in <a href="/390" target="_blank">BIP-390</a>)</li>
</ul>
<p>Remark: some of the examples of invalid descriptor templates may be valid via optional extensions.</p>
<h2> Backwards Compatibility </h2>
<p>The <tt>@</tt> character used for key placeholders is not part of the syntax of output script descriptors, therefore any valid descriptor with at least one <tt>KEY</tt> expression is not a valid descriptor template. Vice versa, any descriptor template with at least one key placeholder is not a valid output script descriptor.</p>
<p>Adoption of wallet policies in software and hardware wallets is opt-in. Conversion from wallet policies to the corresponding descriptors is programmatically extremely easy, and conversion from descriptors to wallet policies (when respecting the required patterns) can be automated. See the reference implementation below for some examples of conversion.</p>
<p>Software wallets are recommended to allow exporting plain descriptors for the purposes of interoperability with software not using wallet policies.</p>
<h2> Reference Implementation </h2>
<p>Wallet policies are implemented in</p>
<ul>
<li>the <a href="https://github.com/LedgerHQ/app-bitcoin-new" target="_blank">Ledger bitcoin application</a> since version 2.1.0;</li>
<li>the <a href="https://github.com/digitalbitbox/bitbox02-firmware" target="_blank">BitBox02 firmware</a> since version v9.15.0;</li>
<li><a href="https://github.com/Blockstream/Jade" target="_blank">Blockstream Jade</a> since version v1.0.24, via <a href="https://github.com/ElementsProject/libwally-core" target="_blank">libwally-core</a> v1.0.0.</li>
<li><a href="https://github.com/btcpayserver/btcpayserver" target="_blank">BTCPay Server</a> from version <a href="https://github.com/btcpayserver/btcpayserver/pull/6684" target="_blank">v2.1.1</a>. (Currently only a limited subset of singlesig and multisig policies)</li>
<li><a href="https://github.com/MetacoSA/NBitcoin/" target="_blank">NBitcoin</a> through <tt>Miniscript.Parse</tt>.</li>
</ul>
<p>For development and testing purposes, we provide a <a href="https://github.com/bitcoin/bips/blob/master/bip-0388/wallet_policies.py" target="_blank">Python 3.7 reference implementation</a> of simple classes to handle wallet policies, and the conversion to/from output script descriptors.
The reference implementation is for demonstration purposes only and not to be used in production environments.</p>
<h2> Change Log </h2>
<ul>
<li><strong>1.1.0</strong> (2024-11):
<ul>
<li>Added support for <tt>musig</tt> key placeholders in descriptor templates.</li>
</ul>
</li>
<li><strong>1.0.0</strong> (2024-05):
<ul>
<li>Initial version.</li>
</ul>
</li>
</ul>
<h2> Footnotes </h2>
<ol>
<li><a href="https://bips.dev/388/#cite_ref_1">^</a> <strong>Why must public keys be distinct?</strong> Reusing pubkeys could be insecure in the context of wallet policies containing <a href="https://bitcoin.sipa.be/miniscript/" target="_blank">miniscript</a>. Avoiding repeated public keys altogether avoids the problem at the source.</li>
</ol>
<h2> Acknowledgments </h2>
<p>The authors would like to thank the people who provided feedback in the bitcoin-dev list, and in person.</p>

        </article>
    </div>


            <hr class="border-slate-700" />

            <div data-pagefind-ignore class="w-full flex flex-col items-center space-y-2 text-center">
                <div class="flex items-center space-x-2">
                    <p class="font-bold">Updated</p>
                    <p class="font-bold">2025-11-02</p>
                </div>
                <p>See an issue with rendering or formatting? Submit an issue on <a href="https://github.com/nickmonad/bips.dev" target="_blank">GitHub</a></p>
                <p>Do you find this site useful? Please consider <a href="https://buy.tryspeed.com/plink_live_lyek4a2yW2Sn2wfA" target="_blank">donating</a> some sats to support ongoing development.</p>
                <p><a href="/">bips.dev</a> is presented by <a href="https://nickmonad.blog" target="_blank">nickmonad</a></p>
                <p class="pt-4 text-sm">All content is owned and licensed by the respective author(s). This website makes no claim of ownership.</p>
            </div>
        </div>
    </div>
</body>
</html>
